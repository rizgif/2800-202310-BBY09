<%- include("templates/header") %>
<section class="profile-section-info">
    <div class="profile-container-avatar">
        <%- include("templates/profile-avatar") %>
    </div>
    <div class="container">
      <main class="form-signin w-100 m-auto">
          <form action='/change-password-submit' method='post' class="needs-validation" novalidate>
              <h1 class="h3 fw-normal">Change Password</h1>

              <div class="form-floating">
                  <input name="oldPassword" type="password" class="form-control" id="old-password" placeholder="Password" required>
                  <label for="oldPassword">Old password</label>
                  <div id="invalid-feedback-old" class="invalid-feedback">
                      Please enter your old password
                  </div>
              </div>

              <div class="form-floating">
                  <input name="password1" type="password" class="form-control" id="password1" placeholder="Password" required>
                  <label for="password1">New Password</label>
                  <div class="invalid-feedback">
                      Please enter a new password
                  </div>
              </div>

              <div class="form-floating">
                  <input name="password2" type="password" class="form-control" id="password2" placeholder="Confirm Password" required>
                  <label for="password2">Confirm Password</label>
                  <div class="invalid-feedback">
                      Please confirm your password
                  </div>
              </div>

              <div class="sign-btns-container">
                <button class="w-100 btn btn-lg btn-primary" type="submit">Save</button>
              </div>
          </form>
      </main>
  </div>
</section>

<script>
  const oldPassword = document.getElementById('old-password');
  const oldPasswordUI = document.getElementById('invalid-feedback-old');
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');

  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

    if (urlParams.get('message')?.length > 1) {
      oldPasswordUI.innerHTML = urlParams.get('message');
        oldPassword.classList.add('is-invalid');
    }

  oldPassword.addEventListener('input', () => {
    if (oldPassword.value.length < 1) {
      oldPasswordUI.innerHTML = 'Please enter your old password';
      oldPassword.classList.remove('is-invalid');
    }
  });

  password2.addEventListener('input', () => {
    if (password1.value !== password2.value) {
      password2.setCustomValidity('Passwords must match.');
    } else {
      password2.setCustomValidity('');
    }
  });

  const form = document.querySelector('.needs-validation');

  form.addEventListener('submit', (event) => {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }

    form.classList.add('was-validated');
  });

</script>

<%- include("templates/footer") %>
